myName=`basename $0`
echo $myName
function CopyCmd {
echo "CopyCmd()"
    BIN=~/bin; mkdir -p $BIN || exit
    for cmd in *; do
        if [ $cmd = "README.md" ] || [ $cmd = $myName ]; then
            continue  # do nothing
        else
echo "Copy $cmd ... to $BIN/"
            cp $cmd $BIN/
        fi
    done
}
REPO=scripts; PIVOT=esd.awk
if [ -d .git ] && [ -x $PIVOT ]; then   # in the repository
echo "pull $REPO"
    git pull && CopyCmd
elif which $PIVOT > /dev/null; then  # maybe already installed
    echo $PIVOT is available. Searching $PIVOT ...
    pushd ~
    for cmd in `find / -name $PIVOT -print 2>/dev/null`; do
        echo $cmd; cd `dirname $cmd`
        if [ -d .git ]; then
            echo A repository is found.
            git pull
            if [ -x $PIVOT ]; then
                bash $myName  # recursive call
                popd && rm $0
                exit     # complete
            fi
        fi
    done
    echo There is no appropriate repository.
    rm `which $PIVOT`
    popd && bash $myName  # retry
elif [ -d $REPO ]; then  # the repository may exist in the subdirectory.
    cd $REPO
    bash $myName  # recursive call
else  # make a repository here.
    INSTALLER=inst_cmd; TMP=/tmp
    if ! which $INSTALLER > /dev/null; then  # not installed.
echo "install $INSTALLER temporarily."
        wget -N -P $TMP https://github.com/leorge/$REPO/raw/master/$INSTALLER
        chmod +x $TMP/$INSTALLER
        PATH=$PATH:$TMP  # temporarily
    fi
    $INSTALLER gawk
    if $INSTALLER git; then
echo "clone $REPO"
        git clone https://github.com/leorge/$REPO.git
        pushd $REPO && bash $myName && popd && rm $0
    elif $INSTALLER unzip; then
echo "download zip file"
        pushd $TMP
            ZIP=master.zip; rm -f $ZIP
            wget -N https://github.com/leorge/$REPO/archive/$ZIP
            unzip $ZIP
            cd $REPO
            CopyCmd
        popd
    else
        ERR=$?
        echo "You can't install git and unzip" >&2
        exit $ERR
    fi
fi
