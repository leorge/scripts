myName=`basename $0`; fullName=$PWD/$$
echo myName=$myName fullName=$fullName; exit
REPO=scripts; INSTALLER=inst_cmd; BIN=~/bin; NULL=/dev/null
if [ -d .git ]; then  # in a git repository
    repository=`grep "url = " .git/config | sed 's#.*/\(.*\)\.git#\1#'`
    if [ $repository != $REPO ]; then
        echo This repository \"$repository\" is not \"$REPO\".
        exit 1
    elif which $INSTALLER > $NULL; then
        $INSTALLER git && git pull
        mkdir -p $BIN; bash addpath $BIN
        for cmd in *; do
            [ -x $cmd ] && cp $cmd $BIN/ 2> /dev/null
        done
    else
        echo "$PWD -->  .."
        cd .. && bash $fullName    # call again
    fi
elif ! which $INSTALLER > $NULL; then   # $INSTALLER is not installed.
    if [ -f $BIN/$INSTALLER ]; then
        PATH=$PATH:$BIN; bash $fullName    # call again after an installer becomes avaiable.
    else
        TMP=/tmp; mkdir -p $TMP; CMD=$TMP/$INSTALLER
        [ -f $CMD ] || wget -P $TMP https://github.com/leorge/$REPO/raw/master/$INSTALLER
        chmod +x $CMD && PATH=$PATH:$TMP && bash $fullName    # call again
    fi
elif [ -d $REPO ]; then # Scripts are in the sub-directory.
    bash $REPO/$myName && rm -f $myName
elif $INSTALLER git; then   # not in a repository
    git clone https://github.com/leorge/$REPO.git && bash $myName
else
    ERR=$?
    echo "Failed to install git(1)." >&2
    echo "Please git clone \"$REPO\" under another operating system, then retry me!" >&2
    exit $ERR
fi
