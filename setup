REPO=scripts; INSTALLER=inst_cmd; NULL=/dev/null
if [ -d .git ]; then # in a git repository
    git pull 2>$NULL
    ./addpath $PWD
elif ! which git >$NULL 2>&1; then    # git(1) is not installed
    if ! which $INSTALLER > $NULL 2>&1; then    # The installer is not available.
        TMP=$HOME/tmp; mkdir -p $TMP; PATH=$PATH:$TMP
        wget -P $TMP https://gitlab.com/qmisort/$REPO/raw/master/$INSTALLER || exit 1
        chmod +x $TMP/$INSTALLER
    fi
    if ! $INSTALLER git; then
        ERR=$?
        echo "Please install git(1), and retry me." >&2
        exit $ERR
    else
        bash $0     # retry me
    fi
elif git clone https://gitlab.com/scripts/$REPO.git; then
    pushd $REPO; bash ./`basename $0`; popd; rm -f $0 # run cloned script
fi

